$(document).ready(function(){external_link_targets();window.template_subnav='';$('.subnav').hover(function(){var subnav=$(this).data('subnavId');subnav_show($(this),subnav)},function(){window.subnav_hide_timeout=setTimeout(subnav_hide,100)});$('.template_subnav').hover(function(){clearTimeout(window.subnav_hide_timeout)},function(){window.subnav_hide_timeout=setTimeout(subnav_hide,100)});$('tbody.sortable').sortable({stop:function(){var index=1;var sort_data=[];$(this).find('tr').each(function(){if(index!=$(this).find('.order').text()){sort_data[index]=$(this).data('rowId');$(this).find('.order').text(index)}
index++});$.ajax({url:$(this).data('sortHandler'),method:'POST',data:{sort_data:sort_data}});stripe_table_rows('#'+$(this).parent('table').attr('id'))},handle:'.sorthandle',axis:'y'});$('.sortable .sorthandle').disableSelection();$('div.entry-content table').each(function(){if(!$(this).attr('id')){$(this).attr('id',('table'+Math.floor(Math.random()*10000)))}
$(this).addClass('general');$(this).addClass('padded');stripe_table_rows('#'+$(this).attr('id'))});$('.multimedia_collection .multimedia_collection_icon a, .multimedia_collection .multimedia_collection_detail h3 a').click(function(e){e.preventDefault();var link_path=$(this).attr('href');var gallery_title=$(this).closest('.multimedia_collection').attr('title');var $fotorama=$('.fotorama');$fotorama.attr('data-path',link_path);$fotorama.attr('data-src',(window.location.pathname+window.location.search));$fotorama.attr('data-src-title',document.title);$fotorama.fotorama();$('video').each(function(){this.pause()});$fotorama.css('display','block');$('#fotorama_close').addClass('active');$('#fotorama_reorder').addClass('active');window.scrollTo(0,0);if(gallery_title){window.history.pushState('',gallery_title,(link_path+'#gallery'))}else{pushstate_get_title(link_path+'#gallery')}
var search=get_fotorama_search(link_path);load_fotorama_data(search,0)});$('.multimedia_gallery_open').click(function(e){e.preventDefault();var link_path=window.location.pathname+window.location.search;var $fotorama=$('.fotorama');$fotorama.attr('data-path',link_path);$fotorama.attr('data-src','');$fotorama.fotorama();$('video').each(function(){this.pause()});$fotorama.css('display','block');$('#fotorama_close').addClass('active');$('#fotorama_reorder').addClass('active');window.scrollTo(0,0);window.history.pushState('',document.title,(window.location.pathname+window.location.search+'#gallery'));var search=get_fotorama_search(link_path);load_fotorama_data(search,0)});if(window.location.hash==='#gallery'){var link_path=window.location.pathname+window.location.search;var $fotorama=$('.fotorama');$fotorama.attr('data-path',link_path);$fotorama.attr('data-src','');$fotorama.fotorama();$('video').each(function(){this.pause()});$fotorama.css('display','block');$('#fotorama_close').addClass('active');$('#fotorama_reorder').addClass('active');window.scrollTo(0,0);var search=get_fotorama_search(link_path);load_fotorama_data(search,0)}
$('#fotorama_close').click(function(e){e.preventDefault();var $fotorama=$('.fotorama');$fotorama.css('display','none');$(this).removeClass('active');$('#fotorama_reorder').removeClass('active');if(($fotorama.data('src'))&&($fotorama.data('srcTitle'))){window.history.pushState('',$fotorama.data('srcTitle'),$fotorama.data('src'))}else{if($fotorama.data('src')){pushstate_get_title($fotorama.data('src'))}else{window.history.pushState('',document.title,(window.location.pathname+window.location.search))}}
$('video').each(function(){this.pause()});$fotorama.data('fotorama').destroy()});$('.multimedia_orderby_change').click(function(){$.ajax({url:ROOT_URL+'multimedia/update_sort.php',success:function(){location.reload()}})});$('.fotorama').on('fotorama:show',function(){$('video').each(function(){this.pause()});var $multimedia_player=$('.multimedia_player');$multimedia_player.addClass('fotorama__select');$multimedia_player.find('video').mediaelementplayer();if($(this).data('fotorama').activeIndex>=($(this).data('fotorama').size-3)){var ad_count=$(this).data('fotorama').size/11;if(ad_count==Math.floor(ad_count)){var link_path=$(this).data('path');var search=get_fotorama_search(link_path);load_fotorama_data(search,($(this).data('fotorama').size-ad_count))}}})});$(window).load(function(){check_google_content()});function subnav_show(selector,subnav)
{clearTimeout(window.subnav_hide_timeout);if(subnav!==window.template_subnav){if(window.template_subnav){subnav_hide()}
var subnav_id='#template_subnav_'+subnav;var subnav_x_offset=15;var subnav_x=$(selector).offset().left-subnav_x_offset;$(subnav_id).css({'left':subnav_x});window.template_subnav=subnav;$(selector).addClass('active');$(subnav_id).slideDown(200)}}
function subnav_hide()
{$('#template_subnav_'+window.template_subnav).slideUp(100);$('.subnav[data-subnav-id="'+window.template_subnav+'"]').removeClass('active');window.template_subnav=''}
function check_google_content()
{$('.google_leaderboard, .google_skyscraper').each(function(index,container){var current_html=$.trim(container.innerHTML);if(current_html.substring((current_html.length-27),current_html.length)!=='class="google_placeholder">'){if(current_html.substring((current_html.length-94),(current_html.length-67))!=='</iframe></ins></ins></ins>'){$.ajax({url:'/_common/ajax/check_google_content.php',data:{section:this.id},success:function(data){$('#'+container.id).html('<a href="'+data.link_url+'"><img src="'+data.image_url+'" class="google_placeholder" alt=" " /></a>')}})}}})}
function external_link_targets()
{$('a[rel=external], a[rel=nofollow], a[rel=publisher], form.external').attr('target','_blank');$('a[target=_blank]').each(function(){var rel=$(this).attr('rel');if(rel==undefined){rel=''}
$(this).attr('rel',$.trim(rel+' noopener noreferrer'))})}
function stripe_table_rows(table)
{$(table+' tbody tr').removeClass('row1');$(table+' tbody tr').removeClass('row2');$(table+' tbody tr:even').addClass('row1');$(table+' tbody tr:odd').addClass('row2')}
function get_fotorama_search(link_path)
{var query;var search;if(link_path.indexOf('search.php')>-1){query=link_path.split('?')[1];if(query){search=JSON.parse('{"'+decodeURI(query).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}else{search={}}}else{query=link_path.replace('multimedia/','').split('/');search={name:query[1],type:query[2]}}
return search}
function load_fotorama_data(search,start)
{if(window.fotorama_loading==1){return}
window.fotorama_loading=1;$.ajax({url:ROOT_URL+'multimedia/search.json?start='+start,async:!0,data:search,success:function(data){if(start>0){for(var n=0;n<data.length;n++){$('.fotorama').data('fotorama').push(data[n])}}else{$('.fotorama').data('fotorama').load(data)}
window.fotorama_loading=0}})}
function pushstate_get_title(path)
{$.ajax({url:'/_common/ajax/get_page_title.php',async:!0,data:{'path':path},success:function(data){window.history.pushState('',data,path)}})}